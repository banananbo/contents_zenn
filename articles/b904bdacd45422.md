---
title: "AWS Transfer Familyã§SFTPã‚µãƒ¼ãƒãƒ¼ã‚’ç«‹ã¦ã‚‹"
emoji: "ğŸŒŸ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [AWS,SFTP,AWS Transfer Family]
published: true
---
## S3ãƒã‚±ãƒƒãƒˆã®ä½œæˆ
SFTPã§ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®S3ãƒã‚±ãƒƒãƒˆã‚’ä½œæˆã™ã‚‹
https://docs.aws.amazon.com/ja_jp/AmazonS3/latest/userguide/create-bucket-overview.html

## IAMãƒ­ãƒ¼ãƒ«ã‚’ä½œæˆ
SFTPã§ä½¿ã†ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆã™ã‚‹
https://docs.aws.amazon.com/ja_jp/transfer/latest/userguide/requirements-roles.html
ã“ã¡ã‚‰ã‚’å‚è€ƒã«ä½œæˆ
### ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒãƒªã‚·ãƒ¼ã‚’ä½œæˆ
- ãƒãƒªã‚·ãƒ¼ â†’ ãƒãƒªã‚·ãƒ¼ã‚’ä½œæˆ
- ä¸‹è¨˜ã§S3ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©ã‚’ä»˜ä¸ã—ã¦ã¿ã‚‹
```
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "AllowListingOfUserFolder",
            "Action": [
                "s3:ListBucket",
                "s3:GetBucketLocation"
            ],
            "Effect": "Allow",
            "Resource": [
                "arn:aws:s3:::bucket_name"
            ]
        },
        {
            "Sid": "HomeDirObjectAccess",
            "Effect": "Allow",
            "Action": [
                "s3:PutObject",
                "s3:GetObject",
                "s3:DeleteObject",
                "s3:DeleteObjectVersion", 
                "s3:GetObjectVersion",
                "s3:GetObjectACL",
                "s3:PutObjectACL"
            ],
            "Resource": "arn:aws:s3:::bucket_name/*"
        }
    ]
}
```
### ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ãƒ¼ãƒ«ã‚’ä½œæˆ
ä¸‹è¨˜ã‚’å‚è€ƒã«
https://docs.aws.amazon.com/ja_jp/transfer/latest/userguide/requirements-roles.html#read-write-access
- ãƒ­ãƒ¼ãƒ«ã€€â†’ã€€ãƒ­ãƒ¼ãƒ«ã‚’ä½œæˆ
- Transferã‚’é¸æŠ
- è¨±å¯ã€€ã§ã€ä½œæˆã—ãŸãƒãƒªã‚·ãƒ¼ã‚’é¸æŠ

### SSHã‚­ãƒ¼ã‚’ä½œæˆã™ã‚‹
```
ssh-keygen -t rsa -b 4096 -f key_name
```

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è¿½åŠ 
https://docs.aws.amazon.com/ja_jp/transfer/latest/userguide/getting-started.html
Transfer ã‹ã‚‰ã€è©²å½“ã‚µãƒ¼ãƒãƒ¼ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ã€ä½œæˆã—ãŸãƒ­ãƒ¼ãƒ«ã‚’å…¥ã‚Œã‚‹
å…ˆç¨‹ä½œæˆã—ãŸã€å…¬é–‹éµã‚‚å…¥ã‚Œã‚‹

### SFTPæ¥ç¶š
```
sftp -i ./keys/sftptest obana-test@s-6838be86f0ee46e6b.server.transfer.ap-northeast-1.amazonaws.com
```
æ¥ç¶šã§ããŸã€‚

### ã‚³ã‚¹ãƒˆã«ã¤ã„ã¦
https://aws.amazon.com/jp/aws-transfer-family/pricing/
ç¾çŠ¶ã€SFTPã‚’ç«‹ã¡ä¸Šã’ã¦ã„ã‚‹é–“èª²é‡‘ã•ã‚Œã‚‹ã‚ˆã†ã ï¼ˆSFTPã®ãƒ‡ãƒ¼ã‚¿è»¢é€é‡ã§ã‚‚èª²é‡‘ã¯ã•ã‚Œã‚‹ï¼‰
10æ™‚é–“ç«‹ã¡ä¸Šã’ã¦ã„ãŸã‚‰ã€ç´„ï¼“ãƒ‰ãƒ«ã®è«‹æ±‚ã«ãªã£ãŸã€€é«˜ã„ãªã€‚ã€‚
åœæ­¢ã—ã¦ã„ã¦ã‚‚ã€å¾“é‡èª²é‡‘ã•ã‚Œã‚‹ã‚ˆã†ãªã®ã§ã€èª²é‡‘ã‚’é¿ã‘ã‚‹ã«ã¯ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’æ¶ˆã™ä»–ãªã„ã®ã‹ã‚‚ã€‚


